<template name="header">

<div class="navbar navbar-inverse navbar-fixed-top bb-topbar">
  <div class="navbar-inner">
    {{> header_loginmute}}
    {{#unless compactHeader}}
    {{> header_lastupdates}}
    {{> header_lastchats}}
    {{/unless}}
    {{> header_breadcrumbs}}
  </div>
</div>
</template>

<template name="header_breadcrumb_chat">
  <a href="/chat/{{type}}/{{id}}" class="chat-link{{#if inThisRoom}} current{{/if}}" title="Chat"><i class="fas fa-comments"></i></a>
</template>

<template name="header_breadcrumb_blackboard">
  <li class="{{#if active}}active{{/if}}">
    <a href="/" class="home-link"><i class="fas fa-chalkboard"></i> Blackboard
    <i class="fas fa-th-list {{#if currentPageEquals "blackboard"}}current{{/if}}"></i></a>
    {{> header_breadcrumb_chat}}
  </li>
</template>

<template name="header_breadcrumb_extra_links">
  {{#if this.link}}
    <a class="{{../type}}-link {{#if active}}{{#if currentViewIs "puzzle"}}current{{/if}}{{/if}}" href="/{{../type}}/{{../id}}/puzzle" title="Puzzle">
      <i class="fas fa-puzzle-piece"></i>
    </a>
  {{/if}}
  {{#if spreadsheet}}
    <a class="{{../type}}-link {{#if active}}{{#if currentViewIs "spreadsheet"}}current{{/if}}{{/if}}" href="/{{../type}}/{{../id}}/spreadsheet" title="Spreadsheet">
      <i class="fas fa-th"></i>
    </a>
  {{/if}}
  {{#if doc}}
    <a class="{{../type}}-link {{#if active}}{{#if currentViewIs "doc"}}current{{/if}}{{/if}}" href="/{{../type}}/{{../id}}/doc" title="Document">
      <i class="fas fa-file"></i>
    </a>
  {{/if}}
    <a class="{{../type}}-link {{#if active}}{{#if currentViewIs "info"}}current{{/if}}{{/if}}" href="/{{../type}}/{{../id}}/info"  title="Info">
      <i class="fas fa-info-circle"></i>
    </a>
  {{> header_breadcrumb_chat ..}}
</template>

<template name="header_breadcrumb_round">
  <li class="{{#if active}}active{{else}}bb-omit-when-narrow{{/if}}">
    <a href="/rounds/{{id}}" class="rounds-link">
      <i class="fas fa-folder-open"></i> Round: {{round.name}}
    </a>
    {{> header_breadcrumb_extra_links round}}
  </li>
</template>

<template name="header_breadcrumb_puzzle">
  <li class="{{#if active}}active{{else}}bb-omit-when-narrow{{/if}}">
    <a href="/puzzles/{{id}}" class="puzzles-link">
      <i class="fas fa-book"></i> Puzzle: {{puzzle.name}}
    </a>
    {{> header_breadcrumb_extra_links puzzle}}
  </li>
</template>

<template name="header_breadcrumb_quip">
  <li class="{{#if currentPageEquals "quip"}}active{{/if}}">
    <a href="/quips/{{id}}" class="quips-link">
      <i class="fas fa-comment-dots"></i> {{#if idIsNew}}Add New Quip{{else}}Quip: {{quip.name}}{{/if}}
    </a>
  </li>
</template>

<template name="header_breadcrumb_oplog">
  <li class="{{#if currentPageEquals "oplog"}}active{{/if}}">
    <a href="/oplogs/0" class="oplogs-link">
      <i class="fas fa-clock"></i> Operation Logs
    </a>
  </li>
</template>

<template name="header_breadcrumb_facts">
  <li class="{{#if currentPageEquals "facts"}}active{{/if}}">
    <a href="/facts" class="facts-link">
      <i class="fas fa-wrench"></i> Server Facts
    </a>
  </li>
</template>

<template name="header_breadcrumb_callins">
  <li class="{{#if currentPageEquals "callins"}}active{{/if}}">
    <a href="/callins" class="callins-link">
      <i class="fas fa-phone"></i> Answer Queue
    </a>
  </li>
</template>

<template name="header_breadcrumbs">
<div class='bb-breadcrumbs{{#if currentPageEquals "blackboard"}} bb-omit-when-narrow{{/if}}'>
<ul class="nav">
  {{#each breadcrumbs}}
    {{> Template.dynamic template=crumb_template}}
  {{/each}}
  <li class="fill">
  {{#if currentPageEquals "chat"}}
    {{> chat_header }}
  {{/if}}
  </li>
  {{#if currentPageEquals "round"}}
    {{> header_breadcrumbs_unsolved_buttons round}}
  {{else if currentPageEquals "puzzle"}}
    {{> header_breadcrumbs_unsolved_buttons puzzle}}
  {{/if}}
  {{#if drive}}
    {{#if picker}}
<li class="bb-drive-buttons">
  <button type="button"
          class="bb-upload-file btn btn-inverse">
    <i class="fas fa-file-upload"></i> Upload file
  </button>
</li>
    {{/if}}
<li class="bb-drive-buttons">
  <span>
  <a class="bb-drive-link btn btn-inverse"
     title="Open Drive Folder"
     target="_blank"
     href="{{drive_link drive}}"><i class="fas fa-inbox"></i></a></span>
</li>
  {{/if}}
</ul>
</div>
</template>

<template name="header_breadcrumbs_unsolved_buttons">
{{#unless solved}}
<li class="bb-drive-buttons">
{{> puzzle_callin_button}}{{> puzzle_summon_button}}
</li>
{{/unless}}
</template>

<template name="header_loginmute">
<!-- login/mute buttons -->
  <div class="bb-buttonbar {{#unless compactHeader}}pull-right{{/unless}}">
   <div>
    {{#if sessionNick}}
     <div class="btn-group{{#if compactHeader}} bb-login{{/if}}">
      <a class="btn btn-small btn-inverse dropdown-toggle"
         data-toggle="dropdown" href="#">
       {{#if sessionNick.gravatar}}
       {{gravatar id=sessionNick.gravatar size=20 image="wavatar"}}
       {{else}}
       <i class="fas fa-user"></i>
       {{/if}}
       {{#if sessionNick.realname}}
         {{sessionNick.realname}}
       {{else}}
         {{sessionNick.name}}
       {{/if}}
       <span class="caret"></span>
      </a>
      <ul class="dropdown-menu pull-right">
       <li><a href="#" class="bb-logout"><i class="fas fa-sign-out-alt"></i> Log out</a></li>
      </ul>
     </div>
    {{else}}
    <button class="btn btn-small btn-inverse bb-login">
     <i class="fas fa-user"></i>
     Log in to {{#if currentPageEquals "chat"}}chat{{else}}edit{{/if}}
    </button>
    {{/if}}
   </div>
   <div class="btn-toolbar">
{{#if currentPageEquals "blackboard"}}
    <div class="btn-group">
     <button title="Protect page" data-canEdit="false"
             class="bb-protect btn btn-small btn-inverse {{#unless canEdit}}active{{/unless}}">
      <i class="fas fa-lock"></i>
     </button>
     <button title="Allow edits to puzzles" data-canEdit="true"
             class="bb-unprotect btn btn-small btn-inverse {{#if canEdit}}active{{/if}} {{#unless sessionNick}}disabled{{/unless}}">
      <i class="fas fa-lock-open"></i>
     </button>
    </div>
{{/if}}
{{#if currentPageEquals "chat"}}
    <div class="btn-group">
     <button title="{{botTitle}}" class="nobot btn btn-small btn-inverse">
      <span class="{{botIcon}}"></span>
     </button>
    </div>
{{/if}}
    <div class="btn-group">
     <button title="{{volumeTitle}}" class="mute btn btn-small btn-inverse">
      <span class="fas {{volumeIcon}}"></span>
     </button>
     <button data-original-title="{{connectStatus.status}}{{#if connectStatus.retryTime}} until {{pretty_ts connectStatus.retryTime}}{{/if}}"
             title="connecting" class="{{connectStatus.status}} btn btn-small btn-inverse">
        <span class="bb-statuslight"></span>
     </button>
    </div>
   </div>
  </div>
</template>

<template name="header_lastupdates">
<!-- Last update bar -->
  <div class="bb-lastupdate">
    <span class="right pull-right">
    <a href="/oplogs/0" class="oplogs-link"
       title="Complete blackboard update log">more...</a>
    </span>
    <span class="left pull-left label label-inverse">
    Last update:
    </span>
    <span class="center">
    {{#with lastupdates}}
    <span class="timestamp">{{pretty_ts timestamp}}</span>
    {{message}}
    <span class="comma-list">{{#each objects}}{{link id}}{{/each}}</span>
    {{#if nick}} (<strong title="{{nickOrName nick}}">{{nick}}</strong>){{/if}}
    {{/with}}
    </span>
  </div>
</template>

<template name="header_lastchats">
<!-- Last chat bar -->
  <div class="bb-lastchat">
    <div class="right pull-right">
      <a href="/chat/general/0" class="chat-link"
         title="Complete loopfinders chat">more...</a><br/>
      <a href="/chat/general/0" class="chat-link bb-pop-out"
         title="Pop out loopfinders chat"
         target="chat0">pop out <i class="fas fa-expand-arrows-alt"></i></a>
    </div>
    <span class="left pull-left label label-inverse">
      Loopfinders:
    </span>
    <span class="center">
    {{#each lastchats}}
    <p class="messageRow">
    <span class="timestamp">{{pretty_ts timestamp}}</span>
    {{#if action}}
      <strong title="{{nickOrName nick}}">{{nick}}</strong> {{msgbody}}
    {{else}}
      <strong title="{{nickOrName nick}}">{{nick}}:</strong>
      {{#if to}}/msg <span title="{{nickOrName to}}">{{to}}</span>{{/if}}
      {{msgbody}}
    {{/if}}
    </p>
    {{/each}}
    </span>
  </div>
</template>

<template name="header_nickmodal_contents">
  <div class="modal-header">
    <h3>Login</h3>
  </div>
  <div class="modal-body">
    <form id="nickPick" class="form-horizontal">
      <div class="control-group" id="passwordInputGroup">
        <label class="control-label" for="passwordInput">Team Password</label>
        <div class="controls">
          <input type="password" id="passwordInput" autocomplete="password"
                 inputmode="verbatim" autofocus
                 placeholder="from listserv or whiteboard" />
          <span class="help-inline">(same for everyone)</span>
        </div>
      </div>
      <div class="control-group" id="nickInputGroup">
        <label class="control-label" for="nickInput">Nick</label>
        <div class="controls">
          <div class="input-prepend">
            <span class="add-on">@</span>
            <input type="text" id="nickInput" autocomplete="nickname"
                    inputmode="verbatim" required
                    placeholder="nick" maxlength=20/>
          </div>
          <span class="help-inline">(1-20 characters)</span>
        </div>
      </div>
      <div class="control-group">
        <label class="control-label" for="nickRealname">Real Name</label>
        <div class="controls">
          <input type="text" id="nickRealname" autocomplete="name"
                  inputmode="latin-name" maxlength=100
                  placeholder="J. Random Codexian" />
          <span class="help-inline">(optional)</span>
        </div>
      </div>
      <div class="control-group">
        <label class="control-label" for="nickEmail">Email
            <div class="gravatar"></div></label>
        <div class="controls">
          <input type="email" id="nickEmail" autocomplete="email"
                  placeholder="user@host.org" maxlength=100 />
          <span class="help-inline">(optional)</span>
          <span class="help-block">Only used to look up
          <a href="https://gravatar.com" target="_blank">Gravatar</a></span>
        </div>
      </div>
    <input type="hidden" id="nickSuccess" value="false" />
    </form>
  </div>
  <div class="modal-footer">
    <span id="loginError" class="warning"></span>
    <button type="button" class="btn btn-primary bb-submit" disabled="{{disabled}}">
      {{#if loggingIn}}Logging in...{{else}}Log in{{/if}}
    </button>
  </div>
</template>

<template name="header_confirmmodal">
  <div class="modal hide" id="confirmModal">
    {{! only insert contents if visible; this lets us manage
        dependencies so we're not updating invisible content }}
    {{#if confirmModalVisible}}{{> header_confirmmodal_contents }}{{/if}}
  </div>
</template>

<template name="header_confirmmodal_contents">
  <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal"
            aria-hidden="true">&times;</button>
    <h3>Are you sure?</h3>
  </div>
  <div class="modal-body">
    <p>{{options.message}}</p>
  </div>
  <div class="modal-footer">
    <button class="btn bb-confirm-ok">{{options.ok_button}}</button>
    <button class="btn bb-confirm-cancel btn-primary" data-dismiss="modal" aria-hidden="true">{{options.no_button}}</button>
  </div>
</template>
